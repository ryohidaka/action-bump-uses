name: "action-bump-uses"

author: "ryohidaka"

description: "GitHub Actions to update the version of the `uses` documented in the README."

branding:
  color: green
  icon: send

runs:
  using: "composite"
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set GitHub Path
      run: echo "GITHUB_ACTION_PATH=${GITHUB_ACTION_PATH}" >> $GITHUB_ENV
      shell: bash

    - name: Get latest release version
      run: |
        LATEST_VERSION=$($GITHUB_ACTION_PATH/scripts/get-version.sh "${{ github.repository }}")
        if [ -z "$LATEST_VERSION" ]; then
          echo "No new version available, skipping update."
          exit 0
        fi
        echo "RELEASE_VERSION=$LATEST_VERSION" >> $GITHUB_ENV
      shell: bash

    - name: Update README.md with release version
      if: env.RELEASE_VERSION != ''
      run: |
        $GITHUB_ACTION_PATH/scripts/update-readme.sh "${{ github.repository }}" "$RELEASE_VERSION"
      shell: bash
      env:
        RELEASE_VERSION: ${{ env.RELEASE_VERSION }}
